% -*- coding: utf-8 -*-

\chapter{Métodos de trabajo y herramientas}
\label{chap:methods}
\drop{E}{l} siguiente capítulo expone la metodología de trabajo escogida para
llevar a cabo el desarrollo del proyecto y describe las principales 
herramientas utilizadas para su realización.

\section{Pasos previos}
Antes de elegir una metodología concreta, se realiza un estudio de campo, para 
identificar cuáles son las partes que componen el sistema y para definir
cuáles son las necesidades de información.

  \subsection{Estudio de campo}
  \label{sec:fieldStudy}
La ~\cite{bib:rae} define restaurante como: \emph{``establecimiento público 
donde se sirven comidas y bebidas, mediante precio, para ser consumidas en el
mismo local''}~\cite{bib:rae}.

Esta definición deja bastante claro cuál es la mecánica básica que siguen 
estos establecimientos, pero no conviene olvidar que existe una gran
variedad de tipos de restaurantes y de modalidades de servicios:

    \subsubsection{Tipos de restaurantes}
  En cuanto a los tipos de establecimientos y fórmulas de restauranción, pueden
  distinguirse cinco clases~\cite{bib:wiki}:
  \begin{itemize}
  \item \textbf{Tipo \emph{buffet}}. Los clientes escogen entre una serie de
  platos cocinados y dispuestos para el autoservicio. Normalmente se oferta
  una gran variedad de productos, pensados para todo tipo de clientes (figura
  \ref{fig:buffet}). El precio por comensal suele ser fijo, aunque también
  existe la modalidad de cobrar por peso o por tipo de platos consumidos.

  \begin{figure}[!h]
    \begin{center}
      \includegraphics[width=0.5\textwidth]{buffet.png}
      \caption{Restaurante tipo \emph{buffet}.}
      \label{fig:buffet}
    \end{center}
  \end{figure}

  \item \textbf{Tipo \emph{fast food}}. Son restaurantes informales en los que
  se consumen platos de rápida preparación como: hamburguesas, perritos
  calientes, patatas fritas, pizzas o \emph{kebabs}, entre otros (figura
  \ref{fig:fastFood}). El usuarios de estos establecimientos busca la rapidez 
  del servicio, no la calidad nutricional o estética de los alimentos 
  servidos. Son, por lo general, los restaurantes más económicos.

  \begin{figure}[!h]
    \begin{center}
      \includegraphics[width=0.6\textwidth]{fastFood.png}
      \caption{Restaurante de comida rápida.}
      \label{fig:fastFood}
    \end{center}
  \end{figure}

  \item \textbf{Tipo \emph{gourmet}}. Son restaurantes de más nivel, tanto por
  los productos preparan, como por la ambientación, la decoración y la atención
  que se ofrece (figura \ref{fig:gourmet}). Los pedidos son ``a la carta'' o
  escogidos de un ``menú'', por lo que los alimentos son cocinados al momento.
  Las mesas son atendidas por una serie de camareros dirigidos por un
  \emph{maître}. El costo va en relación al servicio recibido y a la calidad de
  los platos consumidos.

  \begin{figure}[!h]
    \begin{center}
      \includegraphics[width=0.7\textwidth]{gourmet.png}
      \caption{Restaurante tipo \emph{gourmet}.}
      \label{fig:gourmet}
    \end{center}
  \end{figure}

  \item \textbf{Tipo temático}. Son restaurantes que sirven exclusivamente
  productos típicos de un país o cultura. Suelen estar decorados y ambientados
  con motivos propios de la zona a la que representan (figura
  \ref{fig:themed}). Los tipos de cocina más populares en todo el mundo son: 
  la cocina italiana o la cocina china. Aunque también están muy extendidos 
  los restaurantes de cocina japonesa, brasileña, turca, india o tailandesa,
  entre otros.

  \begin{figure}[!h]
    \begin{center}
      \includegraphics[width=0.7\textwidth]{themed.png}
      \caption{Restaurante con temática china.}
      \label{fig:themed}
    \end{center}
  \end{figure}

  \item \textbf{Tipo \emph{take away}}. Son similares a los restaurantes de
  comida rápida (\emph{fast food}), tanto en la rapidez del servicio, como en 
  el precio y en la calidad de los alimentos. El cliente se confecciona su 
  menú, eligiendo entre una serie de productos expuestos en vitrinas (frías y 
  calientes) (figura \ref{fig:takeAway}) y tiene la opción de consumirlos 
  dentro del establecimiento o puede llevárselos fuera. La vajilla y el menaje 
  que se usan son recipientes desechables.

  \begin{figure}[!h]
    \begin{center}
      \includegraphics[width=0.6\textwidth]{takeAway.png}
      \caption{Restaurante tipo \emph{take away}.}
      \label{fig:takeAway}
    \end{center}
  \end{figure}

  \end{itemize}

  Las categorías citadas anteriormente no son excluyentes. Es decir, un
  restaurante puede estar clasificado en varias categorías. Por ejemplo, es muy
  común que los restaurantes de comida rápida (\emph{fast food}) ofrecezcan los
  servicios de restaurantes con comida para llevar (\emph{take away}). O los
  restaurantes temáticos pueden ofrecer un servicio tipo \emph{gourmet}.

    \subsubsection{Tipos de servicio}
  Según la forma de preparar, presentar y servir la comida y la bebida, un
  restaurante puede tener~\cite{bib:wiki}:
  \begin{itemize}
  \item \textbf{Servicio francés}. La principal característica de este tipo de
  servicio es que el menú es elaborado en presencia del cliente (figura
  \ref{fig:frenchService}). Es decir, los ingredientes se traen de la cocina y
  se muestran al cliente para su inspección. A continuación, son devueltos a la
  cocina, donde se preparan. Y, una vez cocinados, el \emph{maître} prepara las
  raciones frente a la mesa, a gusto de cada comensal y las va sirviendo 
  siempre por la izquierda. Este tipo de servicio requiere gran habilidad por 
  parte del personal y por tanto resulta bastante caro. Es por ello que, sólo 
  suele emplearse en los restaurantes de más alto nivel.

  \begin{figure}[!h]
    \begin{center}
      \includegraphics[width=0.6\textwidth]{frenchService.png}
      \caption{\emph{Maître} preparando raciones frente a una mesa. Típico del 
      \emph{servicio francés}.}
      \label{fig:frenchService}
    \end{center}
  \end{figure}

  \item \textbf{Servicio a la rusa}. Al sentarse, cada comensal encuentra 
  frente a él un plato vacío (el plato de servicio), sobre el que hay colocada 
  una servilleta. Y a izquierda y derecha se extienden los cubiertos que va a
  utilizar (salvo los del postre y alguno específico para carne o pescado)
  (figura \ref{fig:russianService}). Tras elegir aquello que va a tomar, se
  retira el plato de servicio y se van trayendo los platos encargados 
  siguiendo un orden específico (usualmente: sopas y entremeses, primeros 
  platos, segundos platos y postres). Cuando un comensal ha acabado con un 
  plato, el camarero lo retira y le trae el siguiente. Los platos son servidos 
  completamente preparados y presentados, por lo que no se requiere una 
  cualificación especial para los camareros. Esto ayuda a economizar y 
  dinamizar el servicio. En este caso, el \emph{maître} sólamente actúa como 
  jefe de sala, no sirve platos. Es el tipo de servicio de restaurantes más 
  extendido.

  \begin{figure}[!h]
    \begin{center}
      \includegraphics[width=0.6\textwidth]{russianService.png}
      \caption{Mesas equipadas conforme al \emph{servicio a la rusa}.}
      \label{fig:russianService}
    \end{center}
  \end{figure}

  \item \textbf{Servicio a la inglesa}. El comensal encuentra una disposición
  similar a la del \emph{servicio a la rusa}, con la diferencia de que, en este
  caso, el camarero sirve los alimentos desde una fuente o bandeja (siempre por
  la izquierda) (figura \ref{fig:englishService}). Como ocurría en el
  \emph{servicio francés}, el camarero va sirviendo sólamente el producto y la
  cantidad que el cliente solicita. En este tipo de servicio la presentación 
  del plato se pierde y es algo incómodo, tanto para el camarero como para el 
  comensal. Suele emplearse en algunos banquetes.

  \begin{figure}[!h]
    \begin{center}
      \includegraphics[width=0.4\textwidth]{englishService.png}
      \caption{Camarero sirviendo conforme al \emph{sercicio a la inglesa}.}
      \label{fig:englishService}
    \end{center}
  \end{figure}

  \item \textbf{Servicio americano}. Es una simplificación del \emph{servicio a
  la rusa} en el que se prima la rapidez. Los platos y las bebidas se sirven
  por la derecha y se retiran por la izquierda. Los alimentos que se sirven
  requieren poca preparación, tanto para su elaboración como para su servicio
  (figura \ref{fig:americanService}). Es el tipo de servicio más económico.

  \begin{figure}[!h]
    \begin{center}
      \includegraphics[width=0.6\textwidth]{americanService.png}
      \caption{Camarero sirviendo conforme al \emph{sercicio americano}.}
      \label{fig:americanService}
    \end{center}
  \end{figure}

  \end{itemize}

  Los restaurantes \emph{take away}, \emph{fast food} y \emph{buffet} suelen
  carecer de camareros y, por lo tanto, no pueden englobarse dentro de ninguno 
  de los tipos de servicio nombrados anteriormente. En cuanto a los 
  restaurantes de alta cocina (o \emph{gourmets}) y a los \emph{restaurantes 
  temáticos}, el tipo de servicio ofrecido está directamente relacionado con 
  el nivel del establecimiento.

  \subsection{Consideraciones del escenario}
  \label{subsec:scenario}
    \subsubsection{Restaurante tipo}
  El presente \acs{PFC} va orientado a restaurantes de tipo
  \emph{gourmet} o \emph{temático}, que son restaurantes que cuentan con
  servicio de camareros y disponen de una carta de productos. Además, el
  restaurante debe contar con un punto de  control de entrada o
  \textbf{recibidor}, que debe estar custodiado por un \emph{maître}. Este se
  encargará de atender a los clientes que entran y les procurará asiento.

  Por otro lado, el tipo de servicio ofrecido no va a afectar al funcionamiento
  del sistema a desarrollar.

    \subsubsection{Necesidades de información}
  En primer lugar, el sistema debe ser capaz de gestionar la información
  típica con la que trabajan la mayor parte de las aplicaciones de
  restauración que existen hoy en día. Es decir, debe gestionar: la lista
  de productos puestos a la venta; el precio, los impuestos y los
  descuentos de cada uno de ellos; el estado, la lista de pedidos y la
  facturación de cada mesa; etc.

  Por otro lado, el sistema está encaminado a que el cliente pueda 
  identificarse a través de su dispositivo móvil, para: realizar
  pedidos desde su mesa, recibir descuentos y recomendaciones según su
  historial y poder realizar pagos mediante \acs{NFC}. Por lo que, otro de los
  objetos a tener en cuenta \textbf{son los clientes} y el historial que dejan
  a través de sus pedidos y accesos al local.

    \subsubsection{Elección de tecnologías}
  El sistema estará formado por varias aplicaciones que se comunican entre sí.
  Para gestionar los datos con los que trabajan las aplicaciones del
  restaurante se contará con una \textbf{base de datos} distribuida, a la que
  se accederá a través de \textbf{servicios web}. Con esto se conseguirá la
  sincronización y la persistencia de los datos con los que se están trabajando
  en cada momento.

  El uso combinado de la \textbf{tecnología \acs{NFC}} con el de las
  \textbf{etiquetas \acs{RFID}}, permitirán al cliente interactuar con los
  elementos del restaurantes, con el simple hecho de acercar su dispositivo
  móvil a una o a otra etiqueta.

  La tecnología móvil inalámbrica que ofrece mayores posibilidades a la hora
  de comunicar el dispositivo móvil con los equipos fijos del restaurante es
  la tecnología \acs{WiFi}. No obstante, el único dispositivo móvil con el que
  se cuenta (\emph{\textbf{Nokia 6131 \acs{NFC}}}, facilitado por el
  \textbf{\emph{grupo \acs{MAmI}\footnote{Grupo de investigación de la
  \acs{UCLM} que tiene como principal objetivo adaptar las tecnologías para 
  modelar contextos en los que se minimice o desaparezca la interacción del 
  usuario de tal manera que éste perciba la asistencia del entorno que le 
  rodea.}}} y que incluye la tecnología \acs{NFC}) no
  dispone esa tecnología. Por ello, se opta por echar mano de otra de las
  tecnologías inalámbricas más extendidas entre los dispositivos móviles, la
  \textbf{tecnología \texttt{Bluetooth}}.

  \subsection{Aplicación de los servicios web}
  \label{subsec:webServicesApp}
    \subsubsection{Gestión de los datos de un restaurante}
  Como se comentó anteriormente, para garantizar la sincronización de los
datos con los que trabajan las aplicaciones de escritorio del sistema, se va a
definir una aplicación que ofrezca todos los \emph{servicios web} que dichas
aplicaciones necesiten. Es decir, cuando una de estas aplicaciones genere o
necesite algún dato, este será solicitado al \emph{servicio web}
correspondiente.

  Los datos representan el activo más importante del sistema y por ello es
necesario garantizar su integridad. Para conseguirlo, la aplicación que
implementa los \emph{servicios web} será la única que tendrá acceso a una
\emph{base de datos} distribuida donde almacenará y recuperará todos los
datos del sistema.

    \subsubsection{Servicios web en \texttt{.NET}}
La aplicación que da cabida a los servicios web va a implementarse utilizando
el \emph{framework} \texttt{.NET}, al igual que las dos aplicaciones de
escritorio.

Para el desarrollo de servicios web en \texttt{.NET} es conveniente hacer uso
del \acs{IDE} estándar de dicho \emph{framework}, es decir, de \texttt{Visual
Studio}.

El Anexo \ref{chap:webServices} contiene un pequeño tutorial de cómo
crear \emph{servicios web} en \texttt{.NET}.

    \subsubsection{Base de datos \emph{MySQL}}
La base de datos del sistema va a estar implementada utilizando el \acs{SGBD}
relacional, multihilo y multiusuario \texttt{MySQL}. La base de datos
estará formada por varias tablas que almacenarán todos los datos que se
vayan generando en el sistema. Estos datos serán accedidos únicamente por
los servicios web.

Para acceder a la base de datos a través de los servicios web será necesario
el uso de una interfaz de programación para el lenguaje \texttt{C\#}, que es
el lenguaje en el que va a implementarse la aplicación que los contiene. Esta
interfaz está implementada en la biblioteca de enlace dinámico (\acs{DLL})
\emph{MySql.Data.dll}.

En el Anexo \ref{chap:mySQL} se explican detalladamente qué clases y métodos
van a ser utilizados para realizar los accesos a la base de datos desde la
aplicación de los servicios web.

  \subsection{Aplicación de la tecnología \acs{NFC}}
  \label{subsec:nfcApp}
    \subsubsection{Introducción de la tecnología \acs{NFC} en el entorno}
Como ya se ha comentado, uno de los pilares de este proyecto es la
incorporación de la tecnología \acs{NFC} en el ámbito de la restauración.
El objetivo es crear un ambiente inteligente, con el que el cliente puede 
interactuar para obtener una serie de servicios. Para ello, se distribuirán 
por el restaurante de forma estratégica un conjunto de etiquetas \acs{RFID} 
con diferentes cometidos. Cada tipo de etiqueta \acs{RFID} desencadenará en el 
dispositivo móvil una respuesta distinta: iniciará el proceso de registro del 
cliente con el restaurante, añadirá un producto a la lista de productos del 
pedido, enviará el pedido al gestor de pedidos del restaurante, solicitará la 
cuenta o iniciará el proceso de pago mediante \acs{NFC}.

Las características de la tecnología \acs{NFC} favorecerán que las 
interacciones del cliente sean sumamente sencillas e intuitivas, ya que estas 
se producirán automáticamente con el simple acto de aproximar su dispositivo 
móvil a una de las etiquetas \acs{RFID}. Es decir, el cliente podrá acceder
a cada uno de los servicios que se le ofrecen ``tocando'' la etiqueta
correspondiente.

Además, la incorporación de esta tecnología no supondrá la eliminación del
sistema original implantado en el restaurante. Los clientes que no puedan
o no quieran utilizar este sistema, podrán hacer uso de los servicios que 
ofrece el restaurante de la forma ``tradicional''.

    \subsubsection{Nokia 6131 \acs{NFC}}
Como se vió en la figura \ref{fig:nfcGraph} (página
\pageref{fig:nfcGraph}), el número de dispositivos que tienen entre sus 
características la tecnologías \acs{NFC} ha ido aumentando casi 
exponencialmente durante los últimos años. Desgraciadamente, en Europa, aún 
no se ha alcanzado el grado de madurez que la tecnología \acs{NFC} ya tiene 
en países como Japón, Corea del Sur, China o, en menor medida, Estados 
Unidos. Como consecuencia de esto, muchos de los modelos que incorporan
\acs{NFC} no se comercializan todavía en nuestro país.

El dispositivo móvil que va a utilizarse para el desarrollo de este
\acs{PFC} es el \texttt{Nokia 6131 \acs{NFC}} (figura \ref{fig:nokia6131}). 
Aunque a priori, cualquier dispositivo móvil \acs{NFC} que cuente con soporte 
\texttt{Java}, que cuente con tecnología \texttt{Bluetooth} y que implemente las 
\acs{API}s \texttt{\acs{JSR}-257} y \texttt{\acs{JSR}-82} puede beneficiarse 
de los servicios implementados.

\begin{figure}[!h]
  \begin{center}
    \includegraphics[width=0.6\textwidth]{nokia6131.png}
    \caption{\texttt{Nokia 6131 \acs{NFC}}.}
    \label{fig:nokia6131}
  \end{center}
\end{figure}

Las principales características de este dispositivo móvil son:
\begin{itemize}
\item Similar a la versión \texttt{Nokia 6131} convencional.
\item Peso: 112 gramos.
\item Dimensiones: 92x48x20 mm.
\item Pantalla a color \acs{TFT} de 2.2 pulgadas, con resolución de 240x320 
píxeles.
\item Memoria teléfono: 11 MB.
\item Expansión memoria: microSD (hasta 2 GB).
\item Sistema:
  \begin{itemize}
  \item Configuración \texttt{Java}: \texttt{CLDC 1.1}.
  \item Perfil \texttt{Java}: \texttt{\acs{MIDP} 2.0}.
  \item Versión del \acs{SO}: \texttt{S40}.
  \end{itemize}
\item Conectividad:
  \begin{itemize}
  \item \texttt{Bluetooth 2.0} y \texttt{Bluetooth 2.0 EDR}.
  \item \acs{IrDA}.
  \item \acs{NFC}.
  \end{itemize}
\item Y además:
  \begin{itemize}
  \item Soporta las \acs{API}s \texttt{\acs{JSR}-257} y \texttt{\acs{JSR}-82}.
  \item Soporta la lectura y escritura de los principales formatos de
  etiquetas \acs{RFID}: \texttt{Mifare} (1K, 4K y \emph{Ultralight}),
  \texttt{Topaz}, \texttt{Jewel} y \texttt{Felica}.
  \item Soporta comunicación inalámbrica \acs{P2P}.
  \item Contiene un chip interno de 4K que puede funcionar como una tarjeta
  inteligente \texttt{Mifare} para el alojamiento de datos seguros.
  \end{itemize}
\end{itemize}

%El anexo \ref{chap:nokia} contiene las características detalladas de este
%dispositivo.

  \subsubsection{Uso de la \acs{API} \texttt{\acs{JSR}-257}}
En la sección \ref{subsec:java} (la tecnología \texttt{Java}) se comentó, que
las \acs{JSR} son \acs{API}s que extienden la funcionalidad estándar de la 
plataforma \texttt{Java}. En este caso, la \texttt{\acs{JSR}-257} va a
proporcionar la funcionalidad necesaria para implementar aplicaciones que
hagan uso de la tecnología \acs{NFC}, como es el caso de la aplicación móvil
del cliente del sistema definido en el presente \acs{PFC}.

El Anexo \ref{chap:jsr257} contiene un pequeño manual que explica los conceptos
básicos del trabajo con etiquetas inteligentes a través de la \acs{API}
\texttt{\acs{JSR}-257}.

\subsection{Aplicación de la tecnología \texttt{Bluetooth}}
La tecnología ideal para comunicar los dispositivos móviles de los clientes con
los equipos del restaurante sería la tecnología \acs{WiFi}. Desafortunadamente,
el \texttt{Nokia 6131 \acs{NFC}} no cuenta con esta tecnología. Por ello, para
desempeñar tal cometido, se ha seleccionado otra de las tecnologías
inalámbricas que dicho dispositivo si posee, en este caso la tecnología
\texttt{Bluetooth}.

  \subsubsection{Introducción de la tecnología \texttt{Bluetooth} en el entorno}
La tecnología \texttt{Bluetooth} va a facilitar las comunicaciones entre los
dispositivos \acs{NFC} de los clientes y las aplicaciones que forman parte del 
sistema del restaurante.

Estas comunicaciones van a seguir un esquema \emph{\textbf{cliente-servidor}}:
\begin{itemize}
\item El \texttt{cliente \texttt{Bluetooth}} se encargará de las siguientes 
tareas:
  \begin{itemize}
  \item \textbf{Búsqueda los de dispositivos} \texttt{Bluetooth} que estén a su
alcance en modo conectable.
  \item \textbf{Búsqueda los de servicios} que ofrece cada dispositivo.
  \item \textbf{Establecimiento de la conexión} con uno de estos servicios.
  \item \textbf{Comunicación} en forma de lecturas y/o escrituras a través
de una conexión establecida.
  \end{itemize}
\item Por otro lado, el \texttt{servidor \texttt{Bluetooth}} deberá realizar
las siguientes operaciones:
  \begin{itemize}
  \item \textbf{Crear una conexión servidora.}
  \item \textbf{Especificar los atributos de servicio.}
  \item \textbf{Abrir las conexiones clientes.}
  \end{itemize}
\end{itemize}

Por lo tanto, las conexiones serán iniciadas siempre por parte del cliente, 
cuando alguna de las interacciones \acs{NFC} solicite un servicio del
servidor \texttt{Bluetooth} del restaurante. Dependiendo de la interacción, el 
cliente enviará: la solicitud de un pedido, la solicitud de la cuenta o la 
solicitud del ingreso, pago o abandono del local. Todos estos mensajes serán 
enviados irán acompañados de los datos personales (completos o parciales) del 
cliente.

Las respuestas a estas solicitudes serán elaboradas por la correspondiente 
aplicación del restaurante, teniendo en cuenta el estado actual del cliente; y 
se emitirán dentro de la misma conexión. Una vez enviada la respuesta, se
dará por finalizada la comunicación, cerrando la conexión.

Por último, cabe reseñar que, el contar con la tecnología \texttt{Bluetooth} va
a ir acompañado de tener que asumir sus desventajas (que pudieron verse en 
la sección \ref{subsec:disadvantages}). Las que más pueden afectar a la
implementación de la aplicación móvil son las siguientes:
\begin{itemize}
\item La velocidad de transmisión es lenta para archivos pesados. En el
caso del \texttt{Nokia 6131 \acs{NFC}}, la versión del \texttt{Bluetooth} es
la \texttt{2.0 EDR}, por lo que (según la tabla \ref{tab:btSpeed}, página
\pageref{tab:btSpeed}), el ancho de banda es de 3 Mbit/s. Afortunadamente, las
transacciones de datos no se antojan muy pesadas.
\item El alcance es bastante limitado. El \texttt{Bluetooth} del
\texttt{Nokia 6131 \acs{NFC}} es de \emph{Clase 2}, por lo tanto, según
la tabla \ref{tab:btClasses} (página \pageref{tab:btClasses}), el rango
de alcance está en torno a los 25 metros. Dependiendo de la extensión del
restaurante, esto puede suponer un problema.
\item Además, existe una limitación en cuanto a la cantidad de dispositivos 
que pueden estar conectados en una misma red \texttt{Bluetooth}. El máximo es de 
8 dispositivos simultáneos. Como se prevé que las comunicaciones van a ser
más o menos rápido, será difícil que se produzcan más de 8 comunicaciones
simultáneas, a no ser que el restaurante tenga un gran aforo y este esté cerca
del completo.
\end{itemize}

  \subsubsection{La comunicación serie virtual}
Como se ha comentado anteriormente, las comunicaciones inalámbricas que se 
produzcan vía \texttt{Bluetooth} van consistir en: la emisión de un mensaje de 
solicitud por parte del cliente y la respuesta a este por parte del 
restaurante. Los mensajes no van a tener una gran extensión y van a ser 
enviados en forma de cadena de caracteres\footnote{Dependiendo de la 
complejidad del mensaje, la cadena de caracteres irá o no codificada en 
formato \acs{XML}.}. Por este motivo, una \emph{comunicación en serie virtual} 
puede ser la forma más eficiente para llevar a cabo este
procedimiento\footnote{Si se hubieran tenido que transmitir una gran cantidad
de datos como pueden ser archivos binarios completos, hubiera sido más 
conveniente utilizar otra alternativa, como el protocolo \acs{OBEX} para el 
intercambio de archivos.}.

La \emph{comunicación en serie virtual} funciona de forma similar a la
comunicación en serie (\emph{full-duplex}) entre dos PCs conectados 
mediante una interfaz \texttt{RS-232}. Es decir, también se trata de un
tipo de comunicación bidireccional que permite a dos dispositivos
recibir datos previamente serializados, a la vez que transmitirlos por el
puerto serie.

Los puertos reservados para la comunicación serie cableada son el \texttt{COM1}
y el \texttt{COM2}, mientras que todos los demás \texttt{COMx} (o a partir de
donde se acaban los puertos físicos), pueden ser utilizados para la 
\emph{comunicación en serie virtual}.

En este \acs{PFC}, los puertos virtuales van a ser utilizados por los
dispositivos \texttt{Bluetooth} para emular conexiones \texttt{RS-232}
tradicionales.

  \subsubsection{Uso de la \acs{API} \texttt{\acs{JSR}-82}}
Al igual que ocurría con la \texttt{\acs{JSR}-257} para \acs{NFC}, la \acs{API}
\texttt{\acs{JSR}-82} va a proporcionar las clases e interfaces necesarias para
implementar la funcionalidad \texttt{Bluetooth} de la aplicación móvil del
cliente.

El Anexo \ref{chap:jsr82} contiene más información acerca de esta \acs{API}.

  \subsubsection{Uso de la biblioteca \texttt{32feet.NET}}
Las aplicaciones del restaurante van a implementarse utilizando el lenguaje
\texttt{Visual C\# .NET}. Por lo tanto, será necesario hacer uso de una 
biblioteca que contenga una implementación en dicho lenguaje de las 
operaciones típicas de un servidor \texttt{Bluetooth}. Esta biblioteca es la
\texttt{32feet.NET}.

En el Anexo \ref{chap:32feet} se explica qué es \texttt{32feet.NET} y cómo se
implementa un servidor \texttt{Bluetooth} a través de las funciones que
ofrece esta biblioteca.

\section{Metodología de trabajo}
\label{sec:workingMethodology}
Después de los pasos citados anteriormente se decide, para abordar el
desarrollo del proyecto, optar por una adaptación de la metodología de 
\emph{\textbf{prototipado incremental}}.

  \subsection{Prototipado incremental}
El objetivo de este \acs{PFC} es la creación del prototipo de un sistema.
Según ~\cite{bib:software_engineering}, \emph{``un prototipo puede definirse
como un modelo parcial ejecutable de un sistema de software''.} Por lo tanto, 
no se pretende crear un producto final comercializable, sino más bien, un
modelo parcial de un sistema que ayude a comprender cómo funcionaría la
implantación de este sistema bajo las condiciones de un entorno real.

Pero, como su nombre indica, se pretende crear un sistema, es decir, un
\emph{``conjunto de cosas que relacionadas entre sí ordenadamente contribuyen 
a determinado objeto''}~\cite{bib:rae}. Por lo que, la creación de este 
prototipo deberá hacerse teniendo en cuenta que está formado por otros 
prototipos más elementales que están relacionados entre sí.

Según ~\cite{bib:software_engineering}, el prototipado incremental
\emph{``se basa en la generación de varios modelos parciales ejecutables del 
sistema antes de proceder a la implementación (durante la especificación y 
durante el diseño) con el fin de evaluar sus características y poder obtener al 
final el sistema implementado.''.}

Cada nuevo ``modelo parcial'' se obtendrá a partir del ``modelo parcial''
anterior (validado por los usuarios y/o los analistas) junto con la
introducción de nuevos elementos funcionales del sistema. Esto se repetirá
hasta tener el sistema completo implementado (figura
\ref{fig:incremental_prototyping}).

\begin{figure}[!h]
  \begin{center}
    \includegraphics[width=0.9\textwidth]{incremental_prototyping.png}
    \caption{Ciclo de vida del prototipado incremental.}
    \label{fig:incremental_prototyping}
  \end{center}
\end{figure}

Como el sistema está formado por varios prototipos, habrá ``modelos parciales''
en los que estén involucrados varios de estos prototipos y otros en los que
sólo se implementen funcionalidades propias de uno de los prototipos del
sistema.

  \subsection{Estructura general del sistema}
Tras el estudio de campo realizado, las consideraciones del escenario y la
descripción de las principales tecnologías que se van a emplear, se propone
el siguiente escenario (figura \ref{fig:scenario}) como el \emph{escenario
tipo} sobre el cual implementar el sistema.

\begin{figure}[!h]
  \begin{center}
    \includegraphics[width=1\textwidth]{scenario.png}
    \caption{Escenario tipo del sistema.}
    \label{fig:scenario}
  \end{center}
\end{figure}

    \subsubsection{El restaurante}
  El restaurante dispondrá de tres zonas claramente definidas:
  \begin{enumerate}
  \item El \textbf{recibidor}. Es la zona por la que se accede al salón del
  restaurante. Estará regentada por un \emph{maître} que, apoyado por un 
  terminal, registrará la entrada y salida de clientes y la asignación de 
  mesas. Además, el \emph{maître} también se encargará de gestionar los cobros 
  mediante \acs{NFC}.
  \item Las \textbf{mesas}. Cada mesa tendrá un identificador único que la
  diferencie de las demás mesas. Este identificador servirá para poder
  asociar al cliente registrado con la mesa que está ocupando. Cada mesa
  contará con una carta de productos compuesta por varias etiquetas
  \acs{RFID}. Cada etiqueta contendrá la información de un producto. Esto 
  permitirá al cliente elaborar la lista de productos para un pedido
  mediante su dispositivo móvil \acs{NFC}.
  \item La \textbf{barra}. Es la zona donde se reciben los pedidos. Algunos
  podrán ser atendidos sobre la marcha por los camareros y otros necesitarán
  ser elaborados antes por los cocineros. Todos los pedidos recibidos serán
  registrados en un terminal, de manera que se vaya generando una lista de
  pedidos por cada mesa. Esto ayudará a la gestión del estado de dichos 
  pedidos y a la facturación (en conjunto) de los mismos.
  \end{enumerate}

  Tanto el terminal del recibidor como el terminal de la barra dispondrán
  de un punto de conexión \texttt{Bluetooth}, para posibilitar la comunicación
  con el dispositivo móvil de los clientes.

  Por otro lado, uno de los terminales citados u otro terminal distinto (que
  no tiene porqué estar en el mismo establecimiento) se encargará de hospedar
  al \textbf{servicio web}, que es la entidad a la que recurren los otros
  terminales para actualizar sus datos.

  Con la \textbf{base de datos} ocurre lo mismo. Puede encontrarse en uno de
  los terminales del restaurante, en el mismo terminal que el servicio web o
  en un terminal distinto. Se encargará de garantizar la persistencia de los
  datos generados por el sistema.

    \subsubsection{Los clientes}
    \label{subsubsec:clients}
  Habrá dos tipos de clientes:
  \begin{enumerate}
  \item \emph{\textbf{Clientes \acs{NFC}}}. Son potenciales \emph{clientes
  \acs{NFC}} los clientes que tienen un móvil con la tecnología \acs{NFC} y
  \texttt{Bluetooth}. La tecnología \acs{NFC} les permitirá realizar acciones
  como: comunicar su llegada o su salida, pagar o elaborar una lista de
  productos para un pedido; con el simple gesto de tocar unas u otras
  etiquetas \acs{RFID}. El \texttt{Bluetooth} por su parte, permitirá la
  comunicación entre el dispositivo del cliente y los terminales del
  restaurante para, por ejemplo: mandar sus datos personales, recibir
  recomendaciones, enviar pedidos o recibir el resumen de su factura.
  \item \emph{\textbf{Clientes normales}}. Los clientes que no disponen
  de un dispositivo móvil con las características de los \emph{clientes
  \acs{NFC}} o que simplemente no hacen uso de él. Su conducta para con
  el restaurante será la misma que la que se sigue comunmente en este tipo
  de establecimientos: solicita una mesa al \emph{maître}, se sienta,
  pide al camarero lo que desea tomar, se lo sirven, lo consume, solicita
  la cuenta, paga y se va. Este tipo de clientes no podrá recibir
  recomendaciones y no disfrutará de los descuentos que sí se le aplican
  a los \emph{clientes \acs{NFC}}.
  \end{enumerate}

  \subsection{Fases del prototipo}
Como se dijo anteriormente, el prototipo del sistema se construirá de forma
incremental a partir de varias iteraciones en las que se irán añadiendo
nuevas funcionalidades al sistema elemental (de la primera iteración). Las
iteraciones propuestas para el desarrollo del sistema son las siguientes:
\begin{enumerate}
\item Prototipo inicial de los servicios web y la base de datos.
\item Prototipo inicial de la aplicación del \emph{recibidor} y conexión con 
los servicios web.
\item Prototipo inicial de la aplicación de la \emph{barra} y conexión con los 
servicios web.
\item Prototipo inicial de la aplicación móvil.
\item Conexiones \texttt{Bluetooth} entre el prototipo del móvil y el del
\emph{recibidor}.
\item Conexiones \texttt{Bluetooth} entre el prototipo del móvil y el de la
\emph{barra}.
\item Módulo recomendador.
\end{enumerate}

\section{Herramientas}
En esta sección se hace un repaso de las herramientas que han sido utilizadas
para el desarrollo de este \acs{PFC}.

  \subsection{Diagramas \acs{UML}}
  Para cubrir la fase de análisis de requisitos y el diseño de cada una de las
  iteraciones propuestas se ha utilizado el \emph{\textbf{Visual Paradigm
  for \acs{UML}}}, que es una herramienta \emph{case} de especificaciones
  \acs{UML}, desarrollado por la empresa \emph{Visual Paradigm International}.
  Con este programa se han realizado los diagramas de casos de uso, los de
  clases, los de secuencia y el de despliegue. Es decir,
  todos los diagramas que definen la forma en la que está estructurado el
  sistema y la forma en que se comporta.

  La versión utilizada ha sido la \emph{8.3} de la \emph{Community Edition} y
  ha sido necesario solicitar una licencia gratuita, para uso \emph{no 
  comercial}.

  \subsection{Lenguajes de programación}
  El código de los distintos elementos que forman parte del sistema ha sido
  implementado utilizando los siguientes lenguajes de programación:

  \begin{itemize} 
  \item \textbf{C\#}.
  Es un lenguaje de programación \acs{OO} (Orientada a Objetos) desarrollado y
  estandarizado por \emph{Microsoft} como parte de su plataforma \emph{.NET}.

  Con este lenguaje se ha desarrollado la aplicación del \emph{recibidor} y
  la aplicación de la \emph{barra}.

  Además, se ha utilizado la biblioteca externa \emph{32feet.NET}, que
  posibilita las conexiones \texttt{Bluetooth} de las aplicaciones implementadas
  en \emph{C\#} con los dispositivos móviles.

  \item \textbf{ASP.NET}.
  En realidad \emph{ASP.NET} no puede 
  considerarse un lenguaje de programación, más bien es un \emph{framework} 
  que se utiliza para la construcción de sitios web dinámicos, aplicaciones 
  web o servicios web \acs{XML}. \emph{ASP.NET} está construido sobre el
  \emph{Common Language Runtime}, lo que permite a los programadores escribir 
  código \emph{ASP.NET} utilizando cualquier lenguaje admitido por el
  \emph{framework} de \emph{.NET}, como por ejemplo, el propio \emph{C\#}.

  Los servicios web han sido implementados utilizando el \emph{framework}
  \emph{ASP.NET}.

  Además, para poder acceder a la base de datos, se ha utilizado una biblioteca
  externa a \emph{C\#} llamada \emph{MySql.Data}.

  \item \textbf{SQL}.
  \acs{SQL} es un lenguaje declarativo de acceso a bases de
  datos relacionales que permite especificar distintos tipos de operaciones
  sobre estas.

  En este caso la base de datos a la que se accede está montada sobre un
  \acs{SGBD} \emph{MySQL}. Esta base de datos almacena todos los datos de
  interés con los que trabajan las dos aplicaciones del restaurante
  (\emph{recibidor} y \emph{barra}).

  \item \textbf{Java Micro Edition}.
  Es una especificación de un subconjunto de la
  plataforma \emph{Java} orientada a proveer una colección certificada de
  \acs{API}s de desarrollo de software para dispositivos con recursos
  restringidos, como son los dispositivos móviles.

  \acs{JavaME} fue desarrollado mediante el Java Community Process bajo la 
  especificación \texttt{\acs{JSR}-68}. La evolución de la plataforma ha 
  propiciado el abandono de las \emph{Java Specification Request} (peticiones  
  de especificación para \texttt{Java}) en favor de \acs{JSR}s separadas para  
  las distintas versiones de \acs{JavaME}.

  Por ejemplo, para el desarrollo de la aplicación móvil se han utilizado
  principalmente dos \acs{JSR}s:
    \begin{itemize}
    \item \textbf{\acs{JSR}-82}. Que implementa las funcionalidades
    propias de las comunicaciones vía \texttt{Bluetooth} entre dispositivos.
    \item \textbf{\acs{JSR}-257}. Que implementa las funcionalidades propias
    de las comunicaciones \acs{NFC}.
    \end{itemize}

  Además de estas, también se ha hecho uso de la librería
  \texttt{kxml2-min-2.3.0} que permite construir y recorrer documentos o 
  cadenas expresados en \acs{XML}.

  \item \textbf{XML}.
  Es un lenguaje de marcas desarrollado por el
  \emph{World Wide Web Consortium} (\acs{W3C}). Permite definir la gramática de
  lenguajes específicos para estructurar documentos grandes. A diferencia de
  otros lenguajes, \acs{XML} da soporte a bases de datos, siendo útil cuando
  varias aplicaciones se deben comunicar entre sí o integrar información.

  En este caso, se utiliza \acs{XML} para mandar información estructurada 
  entre las aplicaciones del restaurante y los servicios web (a través de la
  red) y entre los dispositivos móviles y las aplicaciones del restaurante 
  (esta vez vía \texttt{Bluetooth}). El anexo \ref{chap:xmls} muestra los 
  distintos tipos de elementos que han sido definidos utilizando \acs{XML}.
  \end{itemize}

  \subsection{Aplicaciones de desarrollo}
  Para implementar las distintas aplicaciones que conforman el sistema se
  ha hecho uso de las siguientes herramientas de desarrollo:
  
  \begin{itemize}
    \item \textbf{Microsoft Visual Studio 2010}.
    Es un entorno de desarrollo integrado (\acs{IDE}) para sistemas operativos
    \emph{Windows}. Soporta lenguajes de programación como \emph{Visual C++},
    \emph{Visual C\#}, \emph{Visual J\#}, \emph{Visual Basic .NET} y
    entornos de desarrollo web como \emph{ASP.NET}, aunque actualmente
    se han desarrollado extensiones para muchos otros.

    Este \acs{IDE} se ha utilizado para desarrollar la aplicación del
    \emph{recibidor}, la aplicación de la \emph{barra} y los servicios web.
    
    \item \textbf{Netbeans IDE 7.0.1}.
    Es un \acs{IDE} libre que no tiene restricciones de uso, concebido 
    originalmente por \emph{Sun MicroSystems} para el desarrollo de proyectos
    en lenguaje \emph{Java}, aunque actualmente existe un gran número de 
    módulos que extienden su funcionalidad.

    Este \acs{IDE} se ha usado para crear la aplicación del dispositivo móvil.
    Para su desarrollo ha sido necesario incluir el módulo \emph{Mobility 
    Pack}, que permite desarrollar aplicaciones en \acs{JavaME}.

    \item \textbf{SDK Nokia 6131 NFC}. 
    Es un kit de desarrollo software (\acs{SDK}) que proporciona una serie
    de \acs{API}s de desarrollo de aplicaciones para el dispositivo móvil
    \emph{Nokia 6131 \acs{NFC}} y, junto al \acs{IDE} \emph{Netbeans},
    permite emular las funcionalidades implementadas sin necesidad de
    cargarlas en un dispositivo móvil real.
    
    \item \textbf{phpMyAdmin 3.4.10.1}.
    Es una herramienta escrita en \emph{PHP} que permite administrar bases
    de datos \emph{MySQL} a través del navegador.

    Ha sido la herramienta utilizada para crear y editar las tablas que
    forman parte de la base de datos del sistema y, en general, la herramienta
    utilizada para administrar los contenidos de dichas tablas.

%    La base de datos utilizada para probar el sistema se encuentra en la
%    dirección: \url{161.67.140.37:3500/}.
%    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%    %%%%%% ¿Poner también usuario y contraseña para acceder a las BBDD?
%    Los servicios web por su parte
%    pueden ser accedidos a través de la dirección:
%    \url{161.67.140.37:3500/ServicioMobiCarta/Services.asmx}. Ambas
%    direcciones pertenecen a uno de los serviciores del grupo \acs{MAmI}.
  \end{itemize}

  \subsection{Repositorio de datos}
  Para un mejor mantenimiento y accesibilidad de la información generada
  durante el desarrollo del \acs{PFC}, se ha optado por almacenar dicha
  información en los repositorios de \emph{Google Code}.

  \emph{Google Code} es una herramienta de \emph{Google} para desarrolladores 
  interesados en el desarrollo de proyectos \emph{open-source}. \emph{Google}
  cede su espacio con la única condición de que la información del proyecto
  sea accesible a todo el mundo.

  La dirección de este \acs{PFC} es la siguiente:\\
  \url{http://code.google.com/p/restaurant-management-using-nfc/}.

  \subsection{Control de versiones}
  \emph{``Se llama control de versiones a la gestión de los diversos cambios 
  que se realizan sobre los elementos de algún producto o una configuración 
  del mismo. Una versión, revisión o edición de un producto, es el estado en 
  el que se encuentra dicho producto en un momento dado de su desarrollo o 
  modificación.''}~\cite{bib:wiki}.
  
  En este caso, como se trabaja con un sistema complejo, formado por varios 
  elementos, cada elemento va generando información en cada etapa de 
  desarrollo y en cada etapa de desarrollo se trabaja con varios archivos; es 
  del todo recomendable registrar en un control de versiones las modificaciones
  que se van realizando en cada uno de los archivos. Esto posibilita llevar
  un seguimiento del cuándo, el dónde y el porqué de cada uno de los cambios;
  y permite volver a estados (o revisiones) anteriores. Además, en colaboración
  con el repositorio de datos, permite tener actualizado el estado de 
  todos los archivos del proyecto aunque el desarrollo se esté realizando en 
  distintas máquinas.

  El sistema de control de versiones (\acs{SVC}) utilizado en este \acs{PFC}
  ha sido \emph{Mercurial}. \emph{Mercurial} es un \acs{SVC} con 
  licencia \emph{\acs{GPL} v2}, multiplataforma, escrito en \emph{Python}.

  Para sistemas \emph{Linux} es habitual utilizar \emph{Mercurial} desde el
  terminal. En sistemas \emph{Windows}, por el contrario, es más común utilizar
  herramientas gráficas que faciliten la ejecución de las principales tareas
  de este \acs{SVC}. En este caso, se han utilizado las siguientes herramientas
  disponibles todas ellas en la página de \emph{Mercurial}
  (\url{http://mercurial.selenic.com/}):
  \begin{itemize}
    \item \emph{\textbf{TortoiseHg 2.2.2}}. Es un conjunto de herramientas 
    gráficas y extensiones de la \emph{shell} para \emph{Mercurial}.
    \item \emph{\textbf{VisualHg}}. Es una extensión para \emph{Visual Studio}
    que permite utilizar la funcionalidad de \emph{Mercurial} sobre los
    archivos de la solución actual.
    \item \emph{Extensión de Mercurial para Netbeans}. Como ocurre con
    \emph{Visual Studio}, también existe una extensión que permite utilizar
    las funcionalidades de \emph{Mercurial} sobre los archivos de los 
    proyectos cargados.
  \end{itemize}

  \subsection{Edición de imagen y gráficos vectoriales}
  Para la elaboración de los iconos y otras imágenes de las aplicaciones, así
  como para la edición de las imágenes del presente documento, se han utilizado
  los siguientes programas:
  \begin{description}
  \item[Gimp 2.6.] \emph{Gimp} o (\emph{\acs{GNU} Image Manipulation Program})
  es un programa de edición de imágenes digitales en forma de mapas de bits.
  Forma parte del proyecto \acs{GNU} y está disponible bajo la licencia
  \acs{GPL}.
  \item[Inkscape 0.48.3.1.] \emph{Inkscape} es un editor de gráficos 
  vectoriales en formato \acs{SVG}. Las características \acs{SVG} soportadas
  incluyen formas básicas, trayectorias, texto, canal alfa, transformaciones,
  gradientes, edición de nodos, exportaciones a \acs{PNG}, agrupación de
  elementos, etc. Al igual que \emph{Gimp}, \emph{Inkscape} también es un
  programa multiplataforma disponible bajo la licencia \acs{GPL}.
  \end{description}

  \subsection{Documentación}
  Para la composición de este documento se ha utilizado el sistema de
  composición de textos \LaTeX. \LaTeX~ es un sistema de composición muy
  adecuado para realizar artículos académicos, tesis y libros técnicos, dado
  que la calidad tipográfica de los documentos realizados es comparable a la
  de una editorial científica de primera línea\cite{bib:LaTeX}. \LaTeX~ es
  software libre bajo licencia \acs{LPPL}.

  Además, se ha utilizado como tipo de documento la clase \emph{arco-pfc}, que
  es una clase elaborada por el \emph{grupo \acs{ARCO}}\footnote{Grupo de
  investigación de la \acs{UCLM} que tiene como objetivo el diseño de
  sistemas complejos con componentes tanto hardware como software, haciendo
  especial énfasis en aspectos como la utilización de recursos, prestaciones
  y comunicaciones, y su aplicación al desarrollo de servicios avanzados en
  áreas tales como la computación distribuida, inteligencia ambiental, redes
  de sencites, \dots~\cite{bib:ARCO}} para la elaboración de \acs{PFC}s y
  \acs{TFG}s y que sigue el formato especificado por la \acs{ESI} de Ciudad 
  Real. \emph{arco-pfc} es un proyecto libre alojado en la web
  \url{https://bitbucket.org/arco_group/arco-pfc}.

  \subsection{Herramientas hardware}
  Las aplicaciones que forman parte del sistema han sido desarrolladas en
  varios ordenadores personales sobre sistemas operativos como: \emph{Windows
  XP SP3}, \emph{Windows 7} y \emph{Ubuntu 12.04}.

  Fuera de esto, para realizar las pruebas reales del sistema, se han utilizado
  los siguientes medios hardware:
  \begin{itemize}
  \item \textbf{\emph{Nokia 6131 \acs{NFC}}}. Dispositivo donde se ejecuta
  la aplicación móvil. Dispone de lector \acs{NFC} y conexión \texttt{Bluetooth}.
  \item \textbf{\emph{Etiquetas \acs{RFID}}}. Tienen 1KB de capacidad. 
  Almacenan sobre mensajes \acs{NDEF} la información de los productos de la 
  carta y de otras operaciones disponibles para el cliente.
  \item \textbf{Monitor táctil}. La aplicación del \emph{recibidor} y la 
  aplicación de la \emph{barra} están enfocadas a la interacción táctil. Por 
  ello es conveniente realizar las pruebas sobre un dispositivo que aproveche 
  esta característica. %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%%% ¿Qué características tiene el monitor táctil? Modelo, dimensiones, etc.
  \end{itemize}

% Local Variables:
%   coding: utf-8
%   mode: latex
%   mode: flyspell
%   ispell-local-dictionary: "castellano8"
% End:
